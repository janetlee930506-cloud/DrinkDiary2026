<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 飲料紀錄 | Drink Diary 2026</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #ffffff;
        }
        /* 客製化捲軸 */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #6285A140;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const App = () => {
            const [currentMonth, setCurrentMonth] = useState(new Date(2026, 0, 1));
            const [records, setRecords] = useState({});
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [selectedDate, setSelectedDate] = useState(null);
            const [editingDrinks, setEditingDrinks] = useState([]);

            // 配色方案
            const TEXT_MAIN = '#707E94';     
            const CALENDAR_ACCENT = '#6285A1'; 
            
            const statsColors = {
                monthCount: '#E2EDF5', 
                monthPrice: '#EAE3F4', 
                yearCount: '#FDF8E6',  
                yearPrice: '#F4E2E2'   
            };

            const ICE_LEVELS = ['正常', '少冰', '微冰', '去冰', '常溫', '溫'];
            const SUGAR_LEVELS = ['全糖', '少糖', '半糖', '微糖', '一分糖', '無糖'];
            const MONTHS = ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'];
            const MONTHS_EN = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            const DAYS = ['日', '一', '二', '三', '四', '五', '六'];
            const DAYS_EN = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];

            useEffect(() => {
                const saved = localStorage.getItem('drink_records_2026_final_v3');
                if (saved) setRecords(JSON.parse(saved));
                lucide.createIcons();
            }, []);

            useEffect(() => {
                lucide.createIcons();
            }, [currentMonth, isModalOpen, editingDrinks]);

            const saveToLocal = (newRecords) => {
                setRecords(newRecords);
                localStorage.setItem('drink_records_2026_final_v3', JSON.stringify(newRecords));
            };

            const { firstDay, days } = useMemo(() => {
                const year = currentMonth.getFullYear();
                const month = currentMonth.getMonth();
                const firstDay = new Date(year, month, 1).getDay();
                const days = new Date(year, month + 1, 0).getDate();
                return { firstDay, days };
            }, [currentMonth]);

            const openEditor = (day) => {
                const dateKey = `2026-${currentMonth.getMonth() + 1}-${day}`;
                setSelectedDate(dateKey);
                setEditingDrinks(records[dateKey] || []);
                setIsModalOpen(true);
            };

            const addDrink = () => {
                if (editingDrinks.length >= 2) return;
                setEditingDrinks([...editingDrinks, {
                    id: Date.now(),
                    shop: '',
                    item: '',
                    price: '',
                    ice: '微冰',
                    sugar: '微糖'
                }]);
            };

            const saveDayRecord = () => {
                const newRecords = { ...records, [selectedDate]: editingDrinks };
                if (editingDrinks.length === 0) delete newRecords[selectedDate];
                saveToLocal(newRecords);
                setIsModalOpen(false);
            };

            const stats = useMemo(() => {
                let yearCount = 0, yearPrice = 0, monthCount = 0, monthPrice = 0;
                const currentMonthStr = `${currentMonth.getMonth() + 1}`;
                Object.entries(records).forEach(([dateKey, drinks]) => {
                    const [, month] = dateKey.split('-');
                    drinks.forEach(drink => {
                        const p = parseFloat(drink.price) || 0;
                        yearCount++;
                        yearPrice += p;
                        if (month === currentMonthStr) {
                            monthCount++;
                            monthPrice += p;
                        }
                    });
                });
                return { yearCount, yearPrice, monthCount, monthPrice };
            }, [records, currentMonth]);

            return (
                <div className="min-h-screen bg-white p-4 md:p-8" style={{ color: TEXT_MAIN }}>
                    <div className="max-w-4xl mx-auto space-y-8">
                        
                        {/* Header */}
                        <div className="flex flex-col items-center gap-2 px-2 border-b pb-8" style={{ borderColor: `${CALENDAR_ACCENT}20` }}>
                            <div className="text-center">
                                <h1 className="text-3xl md:text-4xl font-black flex items-center justify-center gap-3">
                                    <i data-lucide="glass-water" style={{width: 36, height: 36, color: CALENDAR_ACCENT}}></i>
                                    2026 飲料紀錄
                                </h1>
                                <p className="text-[10px] font-bold opacity-60 tracking-[0.3em] mt-2 uppercase text-center">Drink Diary 2026</p>
                            </div>
                            <div className="mt-4 font-bold opacity-20 flex items-center gap-2 text-xs uppercase tracking-[0.5em]">
                                <i data-lucide="calendar" style={{width: 14, height: 14}}></i> 2026 Archive
                            </div>
                        </div>

                        {/* 統計看板 */}
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div className="p-5 rounded-2xl border border-white shadow-sm transition-transform hover:scale-[1.02]" style={{ backgroundColor: statsColors.monthCount }}>
                                <div className="text-sm font-black text-slate-600">當月杯數</div>
                                <div className="text-[9px] font-bold opacity-40 uppercase tracking-tighter mb-2 border-b border-black/5 pb-1">Monthly Count</div>
                                <div className="text-3xl font-black">{stats.monthCount} <small className="text-xs font-normal">杯</small></div>
                            </div>
                            <div className="p-5 rounded-2xl border border-white shadow-sm transition-transform hover:scale-[1.02]" style={{ backgroundColor: statsColors.monthPrice }}>
                                <div className="text-sm font-black text-slate-600">月花費</div>
                                <div className="text-[9px] font-bold opacity-40 uppercase tracking-tighter mb-2 border-b border-black/5 pb-1">Monthly Cost</div>
                                <div className="text-3xl font-black">${stats.monthPrice.toLocaleString()}</div>
                            </div>
                            <div className="p-5 rounded-2xl border border-white shadow-sm transition-transform hover:scale-[1.02]" style={{ backgroundColor: statsColors.yearCount }}>
                                <div className="text-sm font-black text-slate-600">年度杯數</div>
                                <div className="text-[9px] font-bold opacity-40 uppercase tracking-tighter mb-2 border-b border-black/5 pb-1">Annual Count</div>
                                <div className="text-3xl font-black">{stats.yearCount} <small className="text-xs font-normal">杯</small></div>
                            </div>
                            <div className="p-5 rounded-2xl border border-white shadow-sm transition-transform hover:scale-[1.02]" style={{ backgroundColor: statsColors.yearPrice }}>
                                <div className="text-sm font-black text-slate-600">年花費</div>
                                <div className="text-[9px] font-bold opacity-40 uppercase tracking-tighter mb-2 border-b border-black/5 pb-1">Annual Cost</div>
                                <div className="text-3xl font-black">${stats.yearPrice.toLocaleString()}</div>
                            </div>
                        </div>

                        {/* 日曆主體 */}
                        <div className="bg-white rounded-[2rem] border overflow-hidden shadow-sm" style={{ borderColor: CALENDAR_ACCENT }}>
                            <div className="p-6 flex justify-between items-center border-b" style={{ borderColor: `${CALENDAR_ACCENT}30` }}>
                                <button onClick={() => setCurrentMonth(new Date(currentMonth.setMonth(currentMonth.getMonth() - 1)))} className="p-2 hover:bg-slate-50 rounded-full transition-all" style={{ color: CALENDAR_ACCENT }}>
                                    <i data-lucide="chevron-left" style={{width: 24, height: 24}}></i>
                                </button>
                                <div className="text-center">
                                    <h2 className="text-2xl font-black tracking-tighter" style={{ color: CALENDAR_ACCENT }}>{MONTHS[currentMonth.getMonth()]}</h2>
                                    <div className="text-[10px] font-black opacity-50 uppercase tracking-[0.2em]" style={{ color: CALENDAR_ACCENT }}>{MONTHS_EN[currentMonth.getMonth()]}</div>
                                </div>
                                <button onClick={() => setCurrentMonth(new Date(currentMonth.setMonth(currentMonth.getMonth() + 1)))} className="p-2 hover:bg-slate-50 rounded-full transition-all" style={{ color: CALENDAR_ACCENT }}>
                                    <i data-lucide="chevron-right" style={{width: 24, height: 24}}></i>
                                </button>
                            </div>

                            <div className="grid grid-cols-7 text-center font-black py-3 border-b" style={{ borderColor: `${CALENDAR_ACCENT}30` }}>
                                {DAYS.map((d, i) => (
                                    <div key={d} className="flex flex-col" style={{ color: CALENDAR_ACCENT }}>
                                        <span className="text-[11px] font-black">{d}</span>
                                        <span className="text-[8px] opacity-50 font-bold uppercase">{DAYS_EN[i]}</span>
                                    </div>
                                ))}
                            </div>

                            <div className="grid grid-cols-7 auto-rows-[90px] md:auto-rows-[110px]">
                                {[...Array(firstDay)].map((_, i) => (
                                    <div key={`e-${i}`} className="border-r border-b" style={{ borderColor: `${CALENDAR_ACCENT}15`, backgroundColor: '#FBFDFF' }} />
                                ))}
                                {[...Array(days)].map((_, i) => {
                                    const day = i + 1;
                                    const dateKey = `2026-${currentMonth.getMonth() + 1}-${day}`;
                                    const dayDrinks = records[dateKey] || [];
                                    return (
                                        <div key={day} onClick={() => openEditor(day)} className="border-r border-b p-2 hover:bg-slate-50 transition-all cursor-pointer relative group" style={{ borderColor: `${CALENDAR_ACCENT}15` }}>
                                            <span className={`text-xs font-black ${dayDrinks.length > 0 ? '' : 'opacity-30'}`} style={{ color: CALENDAR_ACCENT }}>{day}</span>
                                            <div className="mt-1 space-y-1">
                                                {dayDrinks.map((d, idx) => (
                                                    <div key={idx} className="text-[9px] p-1 rounded-md truncate font-bold border flex justify-center items-center shadow-xs" 
                                                        style={{ 
                                                            backgroundColor: CALENDAR_ACCENT, 
                                                            color: '#FFFFFF', 
                                                            borderColor: CALENDAR_ACCENT 
                                                        }}>
                                                        <span className="truncate">{d.shop || '飲品'}</span>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    </div>

                    {/* 編輯彈窗 */}
                    {isModalOpen && (
                        <div className="fixed inset-0 bg-slate-900/20 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                            <div className="bg-white w-full max-w-xl rounded-[2.5rem] shadow-2xl overflow-hidden border" style={{ borderColor: CALENDAR_ACCENT }}>
                                <div className="p-8 flex justify-between items-center border-b" style={{ backgroundColor: '#FBFDFF', borderColor: `${CALENDAR_ACCENT}30` }}>
                                    <div>
                                        <div className="font-black text-xl" style={{ color: CALENDAR_ACCENT }}>2026 / {selectedDate?.split('-')[1]} / {selectedDate?.split('-')[2]}</div>
                                        <div className="text-[10px] font-black opacity-50 uppercase tracking-widest mt-0.5" style={{ color: CALENDAR_ACCENT }}>Edit Drink Record</div>
                                    </div>
                                    <button onClick={() => setIsModalOpen(false)} className="p-2 hover:bg-slate-100 rounded-full transition-all" style={{ color: CALENDAR_ACCENT }}>
                                        <i data-lucide="x" style={{width: 20, height: 20}}></i>
                                    </button>
                                </div>

                                <div className="p-8 space-y-8 max-h-[60vh] overflow-y-auto bg-white custom-scrollbar">
                                    {editingDrinks.map((drink, index) => (
                                        <div key={drink.id} className="p-6 rounded-[1.5rem] relative border" style={{ borderColor: `${CALENDAR_ACCENT}20`, backgroundColor: '#FBFDFF' }}>
                                            <button onClick={() => setEditingDrinks(editingDrinks.filter(d => d.id !== drink.id))} className="absolute top-6 right-6 p-2 rounded-full hover:bg-rose-50 transition-colors text-rose-300 hover:text-rose-500">
                                                <i data-lucide="trash-2" style={{width: 18, height: 18}}></i>
                                            </button>
                                            <div className="inline-block px-3 py-1 rounded-full text-white text-[9px] font-black uppercase tracking-widest mb-6" style={{ backgroundColor: CALENDAR_ACCENT }}>
                                                Cup {index + 1}
                                            </div>
                                            
                                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                                <div className="space-y-1">
                                                    <label className="text-[10px] font-black opacity-50 uppercase px-1" style={{ color: CALENDAR_ACCENT }}>店名 / Shop</label>
                                                    <input placeholder="例如：五十嵐" value={drink.shop} onChange={e => {
                                                        const u = [...editingDrinks]; u[index].shop = e.target.value; setEditingDrinks(u);
                                                    }} className="w-full bg-white p-3 rounded-xl text-sm border outline-none focus:ring-1 transition-all shadow-sm" style={{ borderColor: `${CALENDAR_ACCENT}30` }} />
                                                </div>
                                                <div className="space-y-1">
                                                    <label className="text-[10px] font-black opacity-50 uppercase px-1" style={{ color: CALENDAR_ACCENT }}>品項 / Item</label>
                                                    <input placeholder="例如：珍奶" value={drink.item} onChange={e => {
                                                        const u = [...editingDrinks]; u[index].item = e.target.value; setEditingDrinks(u);
                                                    }} className="w-full bg-white p-3 rounded-xl text-sm border outline-none focus:ring-1 transition-all shadow-sm" style={{ borderColor: `${CALENDAR_ACCENT}30` }} />
                                                </div>
                                                <div className="space-y-1">
                                                    <label className="text-[10px] font-black opacity-50 uppercase px-1" style={{ color: CALENDAR_ACCENT }}>金額 / Price</label>
                                                    <input placeholder="0" type="number" value={drink.price} onChange={e => {
                                                        const u = [...editingDrinks]; u[index].price = e.target.value; setEditingDrinks(u);
                                                    }} className="w-full bg-white p-3 rounded-xl text-sm border outline-none focus:ring-1 transition-all shadow-sm" style={{ borderColor: `${CALENDAR_ACCENT}30` }} />
                                                </div>
                                            </div>

                                            <div className="mt-6 space-y-4">
                                                <div className="flex flex-wrap gap-2">
                                                    {ICE_LEVELS.map(l => (
                                                        <button key={l} onClick={() => { const u = [...editingDrinks]; u[index].ice = l; setEditingDrinks(u); }}
                                                            className={`px-3 py-1.5 rounded-xl text-[10px] font-bold transition-all border ${drink.ice === l ? 'text-white shadow-md' : 'bg-white text-slate-400'}`}
                                                            style={{ 
                                                                backgroundColor: drink.ice === l ? CALENDAR_ACCENT : 'transparent',
                                                                borderColor: drink.ice === l ? CALENDAR_ACCENT : `${CALENDAR_ACCENT}30`
                                                            }}>
                                                            {l}
                                                        </button>
                                                    ))}
                                                </div>
                                                <div className="flex flex-wrap gap-2">
                                                    {SUGAR_LEVELS.map(l => (
                                                        <button key={l} onClick={() => { const u = [...editingDrinks]; u[index].sugar = l; setEditingDrinks(u); }}
                                                            className={`px-3 py-1.5 rounded-xl text-[10px] font-bold transition-all border ${drink.sugar === l ? 'text-white shadow-md' : 'bg-white text-slate-400'}`}
                                                            style={{ 
                                                                backgroundColor: drink.sugar === l ? CALENDAR_ACCENT : 'transparent',
                                                                borderColor: drink.sugar === l ? CALENDAR_ACCENT : `${CALENDAR_ACCENT}30`
                                                            }}>
                                                            {l}
                                                        </button>
                                                    ))}
                                                </div>
                                            </div>
                                        </div>
                                    ))}

                                    {editingDrinks.length < 2 && (
                                        <button onClick={addDrink} className="w-full py-10 rounded-[1.5rem] border-2 border-dashed flex flex-col items-center gap-2 transition-all group" style={{ borderColor: `${CALENDAR_ACCENT}30`, color: `${CALENDAR_ACCENT}60` }}>
                                            <i data-lucide="plus" style={{width: 24, height: 24}}></i>
                                            <span className="text-[10px] font-black uppercase tracking-[0.15em]">Add Beverage Record (Max 2)</span>
                                        </button>
                                    )}
                                </div>

                                <div className="p-8 flex gap-4 border-t" style={{ backgroundColor: '#FBFDFF', borderColor: `${CALENDAR_ACCENT}20` }}>
                                    <button onClick={saveDayRecord} className="flex-1 py-4 rounded-2xl font-black text-white shadow-lg transition-all active:scale-95 flex items-center justify-center gap-2" style={{ backgroundColor: CALENDAR_ACCENT }}>
                                        <i data-lucide="save" style={{width: 18, height: 18}}></i>
                                        儲存變更 / Save Changes
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Footer */}
                    <div className="max-w-4xl mx-auto mt-12 pb-12 flex flex-col items-center justify-center gap-2 opacity-30 text-[10px] font-black uppercase tracking-[0.3em]" style={{ color: CALENDAR_ACCENT }}>
                        <div className="flex items-center gap-3">
                            <span>Drink Diary 2026</span>
                            <div className="w-1.5 h-1.5 rounded-full" style={{ backgroundColor: CALENDAR_ACCENT }} />
                            <span>2026 Archive</span>
                        </div>
                        <div className="text-[8px] font-bold opacity-60">Stay Hydrated and Happy</div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>